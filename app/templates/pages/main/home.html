{% extends 'pages/main/base.html' %} 

{% block pg_title %}Home{% endblock %}

{% block substyles %}
<link
    rel="stylesheet"
    href="{{ url_for('static', filename='pages/main/styles/home.css') }}"
/>
{% endblock %} 

{% block subscripts %}
<script src="{{ url_for('static', filename='pages/main/scripts/home.js') }}" type="module" defer></script>
{% endblock %} 

{% block page_subheader %}Home{% endblock %} 

{% block page_controls
%}
<div class="current-time-container" aria-label="Current time">
    {% from 'components/_icons.html' import generic %} {{
    generic(icon="nest_clock_farsight_analog") }}
    <div class="current-time">
        <span class="hour">12</span><span>:</span><span class="minute">48</span>
    </div>
</div>
{% endblock %} 

{% block page_content %} 
{% from 'components/_buttons.html' import button %}
<div class="introduction">
    <p class="introduction-text">Hi {{ current_user.first_name }}</p>
</div>

<section class="identities widget" aria-labelledby="identities-heading">
    <div class="widget-header"><span class="form-label" id="identities-heading">Identities</span></div>
    <ul class="identity-list">
        {% for identity in identity_widget %}
            <li class="identity-card {% if identity.active_project.is_overdue %}overdue{% elif identity.active_project.tasks_completed_percentage == 100 %}complete{% endif %}">
                <div class="identity-img">
                    <img src="{{ identity.img }}" alt="{{ identity.name }} Avatar">
                </div>
                <div class="identity-data">
                    <span class="form-label">{{ identity.name }}</span>
                    {% if identity.active_project %}
                        <div class="active-project">
                            <span class="project-text">{{ identity.active_project.name }}</span>
                            <div class="progress-bar">
                                <div class="progress-bar-track">
                                    <div class="progress-bar-display" style="width: {{ identity.active_project.tasks_completed_percentage }}%">
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% elif identity.num_projects %}
                    <div class="num-projects">
                        <span>{{ identity.num_projects }}</span>
                    </div>
                    {% else %}
                    <div class="no-projects">
                        <span class="project-text">No Projects</span>
                    </div>
                    {% endif %}
                </div>
            </li>
    {% endfor %}
    </ul>
</section>

<section class="agenda widget" aria-labelledby="agenda-heading">
    <div class="widget-header"><span class="form-label" id="agenda-heading">Agenda</span></div>
    {% for task in agenda_widget_data %}
        <ul class="agenda-tasks">
            <li class="agenda-card">
                <span>{{ task.name }}</span>
            </li>
        {% else %}
        <div class="empty-agenda">
            <p>No Tasks Today!</p>
        </div>
        {% endfor %}
    </ul>
</section>

<section class="stats widget" aria-labelledby="stats-heading">
    <div class="widget-header"><span class="form-label" id="stats-heading">Stats</span></div>
    <ul class="stats-list">
        {% for key, stat in stats_widget_data.items() %}
        <li class="stats-card">
            <span class="stats-label">{{ stat.label }}:</span>
            <span class="stats-data">{{ stat.count }}</span>
        </li>
        {% endfor %}
    </ul>
</section>

<section class="tasks widget" aria-labelledby="tasks-heading">
    <div class="widget-header">
        <span class="form-label" id="tasks-heading">Tasks</span>
    </div>
    <div class="stacked-bar" aria-hidden="true">
            <div class="stacked-bar-track">
            {% for key, data in task_widget_data.items() %}
                {% if data.legend_key != "total" %}
                    <div 
                    class="stacked-bar-display 
                    {% if data.legend_key == 'easy' %}
                    easy
                    {% elif data.legend_key == 'medium' %}
                    medium
                    {% elif data.legend_key == 'hard' %}
                    hard
                    {% endif %}
                    " style="width: {{ data.percentage }}%">
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    <div class="task-legend">
        <div class="legend-card">
            <div class="legend-color easy"></div>
            <span class="legend-label">Easy</span>
        </div>
        <div class="legend-card">
            <div class="legend-color medium"></div>
            <span class="legend-label">Medium</span>
        </div>
        <div class="legend-card">
            <div class="legend-color hard"></div>
            <span class="legend-label">Hard</span>
        </div>
    </div>
</section>
{% endblock %} 

{% block page_id %}home{% endblock %}
